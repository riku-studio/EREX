ä¸‹é¢ä¸ºä½ æ›´æ–° **æ¶æ„è®¾è®¡æ–‡æ¡£ï¼ˆarchitectureï¼‰**ï¼Œä½¿å…¶ç¬¦åˆï¼š

- åç«¯ï¼š**FastAPI**
- æ•°æ®åº“ï¼š**PostgreSQLï¼ˆdocker-compose.yml å¯åŠ¨ï¼‰**
- å‰ç«¯ï¼š**React**
- è¯­ä¹‰åˆ†ææ¨¡æ¿å¯æ‰©å±•ï¼ˆé…ç½®æ–‡ä»¶å®šä¹‰ï¼Œä¸é€šè¿‡ Web ä¿®æ”¹ï¼‰
- å¤–å›½ç±åˆ†æã€å¤šèŒä½è¯†åˆ«ã€æŠ€èƒ½æŠ½å–ç­‰å‡ä¸º **å¯é€šç”¨çš„é€šç”¨åŒ–æ¨¡å—**
- æ¨¡å—åº”èƒ½æ¥æ”¶â€œæ¨¡æ¿é…ç½®â€ï¼ˆæ­£åˆ™æ¨¡æ¿ / è¯­ä¹‰æ¨¡æ¿ / æŠ€èƒ½æ¨¡æ¿ï¼‰å¹¶æ‰§è¡Œå¯¹åº”åˆ†æ

ä»¥ä¸‹æ–‡æ¡£å¯ç›´æ¥æ”¾å…¥ï¼š

```
docs/architecture/
    system_overview.md
    architecture_design.md
    module_design.md
    data_flow.md
    tech_stack.md
```

æˆ‘å°†æ ¹æ®ä½ çš„è¦æ±‚æ›´æ–°äº†æ‰€æœ‰è®¾è®¡ï¼Œä½¿å…¶æ›´åŠ æ¨¡å—åŒ–ã€æ’ä»¶åŒ–ï¼Œå¯é‡ç”¨ã€‚

------

# ğŸ“˜ **docs/architecture/system_overview.md**

# **ç³»ç»Ÿæ¦‚è¿°ï¼ˆSystem Overviewï¼‰**

EREXï¼ˆExtensible Email Extraction Systemï¼‰æ˜¯ä¸€ä¸ª **å¯é…ç½®ã€å¯æ‰©å±•** çš„é‚®ä»¶è§£æä¸è¯­ä¹‰æå–ç³»ç»Ÿã€‚
 ä¸»è¦ç”¨äºä» PST / MSG / EML é‚®ä»¶ä¸­æŠ½å–ç»“æ„åŒ–ä¿¡æ¯ï¼Œä½†ä¸é™äºæ‹›è˜ä¿¡æ¯ã€‚

ç³»ç»Ÿæ ¸å¿ƒç†å¿µï¼š

- **ä¸€å¥—é€šç”¨ NLP ç®¡é“ï¼ˆPipelineï¼‰**
- **å…¨éƒ¨æ§åˆ¶é€»è¾‘é€šè¿‡é…ç½®é©±åŠ¨ï¼ˆConfig-drivenï¼‰**
- **å‰ç«¯å¯è§†åŒ–å±•ç¤ºç»“æ„åŒ–åˆ†æç»“æœ**
- **åç«¯å¯æ”¯æŒå¤šç§é¢†åŸŸï¼ˆæ‹›è˜ã€åˆåŒæ¡æ¬¾ã€å®¢æˆ·æŠ•è¯‰ç­‰ï¼‰**

é€šè¿‡ä¿®æ”¹ `config/templates/` ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œå³å¯æ‰©å±•ï¼š

- è¯­ä¹‰åˆ†ææ¨¡æ¿ï¼ˆå¦‚ æ‹›è˜ / æ³•åŠ¡ / è´¢åŠ¡ / å®¢æˆ·æŠ•è¯‰ / åˆåŒæœŸé™åˆ¶ ç­‰ï¼‰
- å¤šèŒä½ï¼ˆå¤šæ®µè½ï¼‰è¯†åˆ«è§„åˆ™
- å¤–å›½ç±ï¼ˆæˆ–å…¶ä»–æ¡ä»¶ï¼‰åˆ†ç±»è§„åˆ™
- æŠ€èƒ½ï¼ˆæˆ–å…¶ä»–å…³é”®è¯ï¼‰æŠ½å–è§„åˆ™

ç³»ç»Ÿæ”¯æŒæ¨¡å—åŒ–åŠ è½½ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½å¯ä»¥æŒ‰éœ€å¯ç”¨/ç¦ç”¨ã€‚

------

# ğŸ“˜ **docs/architecture/architecture_design.md**

# **æ¶æ„è®¾è®¡ï¼ˆArchitecture Designï¼‰**

## 1. é«˜å±‚ç³»ç»Ÿæ¶æ„

```
               +----------------------------+
               |         Frontend (React)   |
               |   SPA, Charts, Tables      |
               +-------------+--------------+
                             |
                             | REST API (FastAPI)
                             |
               +-------------v--------------+
               |         Backend API        |
               |   FastAPI + PostgreSQL     |
               +-------------+--------------+
                             |
                   Core Extraction Pipeline
                             |
      +-------------------------------------------------------+
      |                       Core Modules                    |
      |  importer â†’ cleaner â†’ semantic â†’ splitter â†’ extractor |
      |  â†’ classifier â†’ aggregator â†’ statistics               |
      +-------------------------------------------------------+
                             |
                   +---------v-------------+
                   |  PostgreSQL Database  |
                   +------------------------+
```

------

## 2. Pipeline å¤„ç†æµç¨‹ï¼ˆå¯æ’æ‹”ï¼‰

EREX çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ª **Pipeline Orchestrator**ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯ç‹¬ç«‹æ¨¡å—ï¼Œå¯å¼€å…³ï¼š

```
email_import (å¯é€‰æ ¼å¼: eml/msg/pst)
 â†’ body_extractor
 â†’ semantic_filter (æ¨¡æ¿å¯åˆ‡æ¢)
 â†’ block_splitter (æ¨¡æ¿å¯åˆ‡æ¢)
 â†’ keyword_extractor (å¯åˆ‡æ¢æŠ€èƒ½è¯å…¸)
 â†’ classifier (å¯åˆ‡æ¢å¤–å›½ç±è§„åˆ™)
 â†’ aggregator
 â†’ ç»“æ„åŒ–è¾“å‡º
```

æ¯ä¸ªæ¨¡å—éƒ½æ”¯æŒï¼š

- `enabled`: true/false
- é€šè¿‡é…ç½®æ–‡ä»¶åŠ è½½è§„åˆ™
- é¢å‘â€œæ‹›è˜ä¿¡æ¯â€åªæ˜¯ä¸€ä¸ªç‰¹å®šé…ç½®ï¼Œä¸æ˜¯ç³»ç»Ÿé™åˆ¶

------

## 3. PostgreSQL + Docker-compose æ¶æ„

```
docker-compose.yml
â”‚
â”œâ”€â”€ app (FastAPI)
â”œâ”€â”€ db (PostgreSQL)
â””â”€â”€ pgadmin (å¯é€‰)
```

PostgreSQL ç”¨äºå­˜å‚¨ï¼š

- åŸå§‹é‚®ä»¶ç´¢å¼•
- è§£æåçš„ç»“æ„åŒ–èŒä½æ•°æ®
- æŠ€èƒ½ç»Ÿè®¡æ•°æ®
- ç”¨æˆ·è‡ªå®šä¹‰æ¨¡æ¿ï¼ˆæœªæ¥å¯æ‰©å±•ï¼‰

------

## 4. æ¨¡å—åŒ–æ¶æ„ï¼ˆPlugin-like Modulesï¼‰

```
/app/services/
   â”œâ”€â”€ importer/          # æ ¼å¼è§£æï¼ˆeml/msg/pstï¼‰
   â”œâ”€â”€ cleaner/           # æ­£æ–‡æ¸…æ´—
   â”œâ”€â”€ semantic/          # è¯­ä¹‰ç­›é€‰ï¼ˆMiniLMï¼‰
   â”œâ”€â”€ splitter/          # é€šç”¨åˆ†å—æ¨¡å—ï¼ˆæ”¯æŒå¤šèŒä½ã€å¤šæ®µè½ï¼‰
   â”œâ”€â”€ extractor/         # æŠ€èƒ½æŠ½å–ï¼ˆå¯æ¢æ¨¡æ¿ï¼‰
   â”œâ”€â”€ classifier/        # æ¡ä»¶åˆ†ç±»ï¼ˆå¤–å›½ç±/åˆè§„/é£é™©ç­‰ï¼‰
   â”œâ”€â”€ aggregator/        # æ±‡èšå„æ¨¡å—ç»“æœ
   â””â”€â”€ pipeline.py        # ç®¡çº¿ orchestrator
```

æ¯ä¸ªæ¨¡å—éƒ½æ¥å—ï¼š

```python
def run(text: str, config: dict) -> dict:
    ...
```

------

# ğŸ“˜ **docs/architecture/module_design.md**

# **æ¨¡å—è®¾è®¡ï¼ˆModule Breakdownï¼‰**

æ­¤è®¾è®¡ä½“ç°å¯æ‰©å±•æ€§ï¼šä»»æ„æ¨¡å—éƒ½å¯ç”¨äºâ€œæ‹›è˜é¢†åŸŸä»¥å¤–çš„ç”¨é€”â€ã€‚

------

## 1. importerï¼ˆé‚®ä»¶å¯¼å…¥æ¨¡å—ï¼‰

### åŠŸèƒ½ï¼ˆé€šç”¨åŒ–ï¼‰

- æ”¯æŒ EML / MSG / PST
- è¿”å›ç»Ÿä¸€ç»“æ„ä½“ï¼ˆä¸å±€é™äºæ‹›è˜ï¼‰

### è¾“å‡ºç»“æ„ï¼š

```json
{
  "id": "...",
  "subject": "...",
  "body_raw": "...",
  "from": "...",
  "date": "..."
}
```

------

## 2. cleanerï¼ˆæ­£æ–‡æ¸…æ´—æ¨¡å—ï¼‰

### åŠŸèƒ½ï¼ˆé€šç”¨ï¼‰

- å» HTML æ ‡ç­¾
- æ¸…ç†å¼•ç”¨
- ç§»é™¤ç­¾å
- æ ‡å‡†åŒ–æ¢è¡Œ

### è¾“å‡ºï¼š

```
body_clean
```

é€‚ç”¨äºä»»ä½•é¢†åŸŸï¼Œè€Œéä»…æ‹›è˜è§£æã€‚

------

## 3. semanticï¼ˆé€šç”¨è¯­ä¹‰ç­›é€‰ï¼‰

### åŠŸèƒ½

- åŸºäºæ¨¡æ¿ï¼ˆconfig/templates/*.jsonï¼‰
- å‡†ç¡®ç­›é€‰ä¸æ¨¡æ¿ä¸»é¢˜ç›¸å…³çš„å¥å­

### ç¤ºä¾‹æ¨¡æ¿ï¼š

```
/config/templates/recruitment.json
/config/templates/foreigner.json
/config/templates/legal.json
```

ç”¨æˆ·å¯è‡ªå®šä¹‰ï¼š

```json
{
  "name": "recruitment",
  "template": [
    "æ±‚äººæƒ…å ±", "å‹Ÿé›†è¦é …", "å¿…é ˆã‚¹ã‚­ãƒ«", "é–‹ç™ºçµŒé¨“"
  ]
}
```

------

## 4. splitterï¼ˆé€šç”¨åˆ†å—è¯†åˆ«ï¼‰

### åŠŸèƒ½

å¯¹æ–‡æœ¬æŒ‰è‡ªå®šä¹‰è§„åˆ™åˆ‡å‰²æˆå¤šä¸ªâ€œå—â€

é€‚ç”¨äºï¼š

- å¤šèŒä½è¯†åˆ«
- å¤šæ¡åˆåŒæ¡æ¬¾è¯†åˆ«
- å¤šæ®µå®¢æˆ·æŠ•è¯‰è¯†åˆ«

### é€šè¿‡é…ç½®é©±åŠ¨ï¼š

```
/config/patterns/recruitment_split.json
/config/patterns/legal_split.json
```

è§„åˆ™æ ¼å¼ï¼š

```json
{
  "patterns": [
    "(?=ã€[^ã€‘]+ã€‘)",
    "(?=â– æ¡ˆä»¶)",
    "(?=â—†æ¡ˆä»¶)"
  ]
}
```

------

## 5. extractorï¼ˆé€šç”¨å…³é”®å­—æŠ½å–ï¼‰

ä¸ä»…ç”¨äºâ€œæŠ€èƒ½æŠ½å–â€ï¼Œä¹Ÿå¯ç”¨äºï¼š

- åˆåŒæœŸæ¡æ¬¾æŠ½å–
- é£é™©å…³é”®è¯æŠ½å–
- è´¢åŠ¡å…³é”®è¯æŠ½å–

å…³é”®å­—å­—å…¸ï¼š

```
config/keywords/skills.json
config/keywords/legal_risk.json
config/keywords/complaint.json
```

æŠ€èƒ½ä¾‹å­ï¼š

```json
{
  "keywords": ["Java", "C++", "Python", "AWS", ...]
}
```

æ¨¡å—è‡ªåŠ¨åšé•¿åº¦æ’åºï¼Œé¿å…è¯¯åŒ¹é…ã€‚

------

## 6. classifierï¼ˆé€šç”¨åˆ†ç±»æ¨¡å—ï¼‰

ä¸ä»…ç”¨äºâ€œå¤–å›½ç±å¯/ä¸å¯â€ï¼Œä¹Ÿå¯ä»¥æ‰©å±•æˆï¼š

- åˆè§„/ä¸åˆè§„
- é£é™©/å®‰å…¨
- æ˜¯å¦éœ€è¦åœ¨ç•™è³‡æ ¼
- æ˜¯å¦æ˜¯ç´§æ€¥æ¡ˆä»¶
- æ˜¯å¦ NDA é™åˆ¶

é€šè¿‡é…ç½®æ–‡ä»¶å®šä¹‰è§„åˆ™ï¼š

```
/config/classifiers/foreigner.json
/config/classifiers/legal_risk.json
```

æ ·ä¾‹ï¼š

```json
{
  "classes": {
    "ok": ["å¤–å›½ç±å¯", "å›½ç±ä¸å•"],
    "ng": ["å¤–å›½ç±ä¸å¯", "å¤–å›½ç±NG", "æ—¥æœ¬å›½ç±ã®ã¿"],
    "unknown": []
  }
}
```

------

## 7. aggregatorï¼ˆèšåˆæ¨¡å—ï¼‰

å°†å¤šä¸ªæ¨¡å—è¾“å‡ºåˆå¹¶ä¸ºç»“æ„åŒ–ç»“æœï¼š

```json
{
  "blocks": [
    {
      "text": "...",
      "semantic_hits": [...],
      "keywords": [...],
      "classify_result": "...",
      "stats": {...}
    }
  ]
}
```

é€‚ç”¨äºä»»ä½•æ¨¡æ¿ç±»å‹çš„æŠ½å–ã€‚

------

## 8. pipelineï¼ˆæ ¸å¿ƒ orchestratorï¼‰

é…ç½®åŒ–ï¼š

```json
{
  "pipeline": [
    "cleaner",
    "semantic",
    "splitter",
    "extractor",
    "classifier",
    "aggregator"
  ]
}
```

ç”¨æˆ·å¯ä»¥å…³é—­/æ·»åŠ æ­¥éª¤ï¼š

```
pipeline.remove("classifier")
pipeline.add("custom_module")
```

------

# ğŸ“˜ **docs/architecture/data_flow.md**

# **æ•°æ®æµï¼ˆData Flowï¼‰**

```
     +--------------+
     |  é‚®ä»¶æ–‡ä»¶    |
     +------+-------+
            |
            v
      importer (æ ¼å¼è§£æ)
            |
            v
      cleaner (æ­£æ–‡æ¸…æ´—)
            |
            v
      semantic (åŸºäºæ¨¡æ¿ç­›é€‰)
            |
            v
      splitter (å¤šå—è¯†åˆ«)
            |
            v
      extractor (å…³é”®å­—æŠ½å–)
            |
            v
      classifier (æ¡ä»¶åˆ†ç±»)
            |
            v
      aggregator (ç»Ÿä¸€ç»“æ„åŒ–)
            |
            v
      PostgreSQL â†â†’ FastAPI â†’ React å‰ç«¯
```

ä¸â€œæ˜¯å¦æ‹›è˜â€æ— å…³ï¼Œè¯¥ Pipeline å¯é€‚ç”¨äºä»»ä½• NLU æå–ä»»åŠ¡ã€‚

------

# ğŸ“˜ **docs/architecture/tech_stack.md**

# **æŠ€æœ¯æ ˆï¼ˆTech Stackï¼‰**

| å±‚çº§       | æŠ€æœ¯                                 |
| ---------- | ------------------------------------ |
| åç«¯æ¡†æ¶   | FastAPI                              |
| å‰ç«¯       | React (Vite / CRA)                   |
| æ•°æ®åº“     | PostgreSQLï¼ˆDocker éƒ¨ç½²ï¼‰            |
| é‚®ä»¶è§£æ   | pypff, extract_msg, Python email     |
| NLP        | sentence-transformers (MiniLM-L6-v2) |
| æ–‡æœ¬åˆ†å—   | Regex + é…ç½®é©±åŠ¨                     |
| å…³é”®å­—æŠ½å– | å®šåˆ¶ Trie + Regex                    |
| åˆ†ç±»æ¨¡å—   | é…ç½®é©±åŠ¨å¤šåˆ†ç±»å™¨                     |
| é…ç½®       | YAML / JSON                          |
| éƒ¨ç½²       | docker-compose                       |

